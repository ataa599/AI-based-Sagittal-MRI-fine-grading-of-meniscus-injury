<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DICOM Inference Results</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .region-block { border: 1px solid #ccc; padding: 20px; margin-bottom: 30px; border-radius: 8px; }
        .region-title { font-size: 1.3em; font-weight: bold; margin-bottom: 10px; }
        .meta-table { border-collapse: collapse; margin-top: 10px; }
        .meta-table td, .meta-table th { border: 1px solid #ddd; padding: 6px 12px; }
        .meta-table th { background: #f5f5f5; }
        img { max-width: 300px; display: block; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1>DICOM Inference Results</h1>
    <input type="file" id="zipInput" accept=".zip">
    <button onclick="uploadZip()">Upload & Infer</button>
    <div id="results"></div>

    <script>
    async function uploadZip() {
        const input = document.getElementById('zipInput');
        if (!input.files.length) {
            alert('Please select a zip file containing DICOM images.');
            return;
        }
        const file = input.files[0];
        const formData = new FormData();
        formData.append('zip_file', file);
        document.getElementById('results').innerHTML = '<p>Processing...</p>';
        try {
            const response = await fetch('/infer-folder/', {
                method: 'POST',
                body: formData
            });
            const data = await response.json();
            displayResults(data);
        } catch (err) {
            document.getElementById('results').innerHTML = '<p>Error: ' + err + '</p>';
        }
    }

    function displayResults(data) {
        const regions = ['posterior_horn_image', 'anterior_horn_image', 'body_image'];
        let html = '';
        regions.forEach(region => {
            if (data[region]) {
                html += `<div class="region-block">
                    <div class="region-title">${data[region].region}</div>
                    <img src="data:image/png;base64,${data[region].image_base64}" alt="${region}">
                    <div>Predicted Severity: <b>${data[region].predicted_severity}</b></div>
                    <div>Confidence: <b>${data[region].confidence}</b></div>
                </div>`;
            }
        });
        document.getElementById('results').innerHTML = html;
    }
    </script>
</body>
</html>
